using Backend.Features.Settings.Repositories;

namespace Backend.Features.Settings.Operations.Create;

public class CreateSettingsValidator : AbstractValidator<CreateSettingsRequest>
{
    private readonly ISettingsRepository _settingsRepository;

    public CreateSettingsValidator(ISettingsRepository settingsRepository)
    {
        _settingsRepository = settingsRepository;
        
        RuleFor(a => a)
            .MustAsync(IsTableEmpty)
            .WithMessage("An entry in the settings table is already present.");
    }
    
    private async Task<bool> IsTableEmpty(CreateSettingsRequest e, CancellationToken token)
    {
        return !await _settingsRepository.IsTableEmpty();
    }
}