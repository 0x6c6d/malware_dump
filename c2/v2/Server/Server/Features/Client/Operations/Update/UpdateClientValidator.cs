using Server.Features.Client.Repositories;

namespace Server.Features.Client.Operations.Update;

public class UpdateClientValidator : AbstractValidator<UpdateClientRequest>
{
    private readonly IClientRepository _clientRepository;

    public UpdateClientValidator(IClientRepository clientRepository)
    {
        _clientRepository = clientRepository;
        
        RuleFor(a => a)
            .MustAsync(ClientIpUnique)
            .WithMessage("A database entry for a client with this ip already exists.");
    }
    
    private async Task<bool> ClientIpUnique(UpdateClientRequest e, CancellationToken token)
    {
        return !await _clientRepository.IsClientIpUnique(e.Ip);
    }
}