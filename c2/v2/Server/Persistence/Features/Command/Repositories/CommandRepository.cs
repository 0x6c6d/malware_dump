using Microsoft.EntityFrameworkCore;
using Persistence.Common.Persistence;
using Persistence.Common.Persistence.Repositories;
using Persistence.Features.Command.Models;

namespace Persistence.Features.Command.Repositories;

public class CommandRepository(DataContext dbContext) : BaseRepository<CommandModel>(dbContext), ICommandRepository
{
    private readonly DataContext _dbContext = dbContext;

    public async Task<List<CommandModel>?> GetCommandsByIp(string ip)
    {
        var commands = await _dbContext.Commands.Where(command => command.Ip.ToLower() == ip.ToLower())
            .OrderByDescending(command => command.ExecutionDateTime).ToListAsync();
        return commands;
    }
}