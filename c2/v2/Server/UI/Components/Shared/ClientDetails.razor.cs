using Persistence.Features.Command.Models;
using UI.Models;

namespace UI.Components.Shared;

public partial class ClientDetails
{
    private string? _message;
    private bool _showModal = false;
    private ClientViewModel? _client;
    private List<CommandModel>? _commands;
    
    #region Helper
    
    private void CloseModal()
    {
        _showModal = false;
        StateHasChanged();
    }

    public async Task OpenModel(ClientViewModel model)
    {
        _client = model;
        _showModal = true;
        StateHasChanged();

        if (string.IsNullOrEmpty(model.Ip))
        {
            _message = "Client ip is empty";
            return;
        }
        
        await FetchClientCommands(model.Ip);
    }
    
    private async Task FetchClientCommands(string ip)
    {
        _message = string.Empty;
        
        var result = await commandService.GetCommandPerClientAsync(ip);
        if (!result.Success)
        {
            _message = !string.IsNullOrEmpty(result.Message)
                ? result.Message
                : "Error while fetching all clients from the database";
            return;
        }

        if (result.Data == null || result.Data.Count == 0)
        {
            _message = "No commands found for this ip";
            return;
        }
        
        _commands = result.Data;
    }
    
    #endregion
    
    
}